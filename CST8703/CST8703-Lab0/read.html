<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Kyle Chisholm" />
  <meta name="dcterms.date" content="2022-05-17" />
  <meta name="keywords" content="POSIX, Raspberry Pi" />
  <title>CST 8703 Lab 0 - Hello Real-Time World</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">CST 8703 Lab 0 - Hello Real-Time World</h1>
<p class="author">Kyle Chisholm</p>
<p class="date">2022-05-17</p>
</header>
<p>Real-Time Systems and Embedded Programming</p>
<p><strong>Submission Deadline</strong>: May 19, 2022</p>
<p><strong>Online version of this document</strong>: <a href="https://chishok.github.io/CST8703/CST8703-Lab0">https://chishok.github.io/CST8703/CST8703-Lab0</a></p>
<p>This lab will provide a tutorial on how to install and configure a Raspberry Pi for remote development. POSIX with realtime extensions will be introduced and a Linux application written in C will showcase basic clock and pthread functions.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> There is currently a global shortage of Raspberry Pi boards. If you do not have a Raspberry Pi, simply use WSL (follow instructions below), native Ubuntu Linux, or Virtualbox to configure your development environment, build and run software in a POSIX-compliant environment.</p>
</blockquote>
<h2 id="background">Background</h2>
<p>The Portable Operating System Interface (POSIX) provides an interface for operating systems, applications, and real-time embedded development on platforms like <a href="https://source.denx.de/Xenomai/xenomai/-/wikis/home">Xenomai</a>, <a href="https://www.windriver.com/products/vxworks">VxWorks</a>, <a href="https://blackberry.qnx.com/en/products/foundation-software/qnx-rtos">QNX</a>, and many more. <a href="https://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_POSIX/index.html">FreeRTOS</a>, a popular Real-Time Operating System (RTOS), also provides a wrapper for the POSIX threading API (commonly known as pthreads).</p>
<p>A robust development environment and tools are necessary for building and debugging applications. Proprietary Real-Time Operating Systems (RTOS) typically provide a host IDE with extensive documentation to get started. For Free and Open-Source Software (FOSS) such as the Linux operating system, development environments are as numerous are there are developers who use them. This lab provides a setup guide for the Raspberry Pi and a C development environment. Python, Bash, and CMake will also be used for scripting and managing the build and execution process.</p>
<p>The series of labs in this course make use of the “headless” version of the Raspberry Pi OS which does not have a desktop environment (graphical interface). A desktop environment can be installed, but embedded programming is typically done on a separate host machine with a cross-compiler and remote debugging tools. For the course labs, the embedded software is built and run on the target Raspberry Pi over a network connection. VS Code will be used as the primary Integrated Development Environment (IDE).</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> This course is focused on developing real-time embedded applications. However, there are many other aspects of creating embedded Linux systems, including cross-compiling with toolchains, bootloaders, kernel configuration, filesystems, build systems, drivers. etc. <a href="https://www.amazon.ca/Mastering-Embedded-Linux-Programming-potential/dp/1789530385">Mastering Embedded Linux Programming</a> is a good reference to go deeper into these areas of embedded Linux systems, if interested.</p>
</blockquote>
<h3 id="useful-links-and-references-for-help-with-c-posix-and-bash">Useful Links And References For Help With C, POSIX, and Bash</h3>
<p>The Linux <code>man</code> pages are an indispensable tool for any systems developer, and especially for POSIX real-time systems. You can access man pages online at <a href="https://man7.org/linux/man-pages">https://man7.org/linux/man-pages</a> or simply use the command line tool <code>man</code> on any modern Linux distribution. Type <code>man man</code> in the terminal for more information. In addition to the course textbook, the following resources are helpful when writing code for embedded Linux:</p>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="header">
<th>Reference</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://man7.org/tlpi">https://man7.org/tlpi</a> <span class="citation" data-cites="Kerrisk2010">[<a href="#ref-Kerrisk2010" role="doc-biblioref">1</a>]</span></td>
<td>The ultimate reference for Linux and UNIX system programming.</td>
</tr>
<tr class="even">
<td><a href="https://www.amazon.ca/Modern-C-Jens-Gustedt/dp/1617295817">Modern C</a></td>
<td>Great resource for C language coding.</td>
</tr>
<tr class="odd">
<td><a href="https://www.amazon.ca/Mastering-Embedded-Linux-Programming-potential/dp/1789530385">Mastering Embedded Linux Programming</a></td>
<td>Build full embedded solutions and cross-compile with Yocto or buildroot.</td>
</tr>
</tbody>
</table>
<p>There is an excellent online book on using <a href="https://cliutils.gitlab.io/modern-cmake/">CMake here</a> but the labs won’t require alterations to the build configurations.</p>
<h3 id="coding-best-practices-standards-and-formatting">Coding Best Practices, Standards, and Formatting</h3>
<p>Code quality monitoring, testing, static analysis, and standards compliance are important when developing embedded code for safety-critical realtime systems in industry. Adhering to coding standards and formatting can go a long way in maintaining readable “clean” code. The <a href="https://barrgroup.com/embedded-systems/books/embedded-c-coding-standard">Barr Embedded C Standard</a> is recommended to follow when writing C code for systems where safety and security are important.</p>
<p>Several configuration files, tools, and VS Code extensions are helpful when writing and debugging code. A brief description of the tools will be provided during the installation procedures in the <a href="#methods">Methods</a> section, but you are encouraged to learn more about them and personalize your development environment.</p>
<h3 id="using-linux-with-the-command-line">Using Linux With the Command Line</h3>
<p>The series of labs in this course require basic knowledge using a Bash shell (Linux command line). There are <a href="https://www.redhat.com/sysadmin/learn-bash-scripting">plenty of tutorials online</a> to gain familiarity with Bash. <a href="https://stackoverflow.com/">Stack overflow</a> and the <a href="https://stackexchange.com/sites">stack exchange network sites</a> are also excellent resources to find answers to programming questions, including C, Unix/Linux bash scripts and tools.</p>
<h2 id="materials">Materials</h2>
<ol type="1">
<li><p><a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a> or <a href="https://www.raspberrypi.com/products/raspberry-pi-zero-2-w/">Raspberry Pi Zero 2 W</a>.</p>
<p>A Raspberry Pi also requires a power source, MicroSD card, and case. A breakout cable for the GPIO with a breadboard is also useful for prototyping with hardware. The following list of items link to accessories required for using the Raspberry Pi. It is encouraged to search for similar products if the cost is too high or the linked items are no longer available.</p>
<ol type="1">
<li><a href="https://www.amazon.ca/Enokay-Raspberry-Supply-Charger-Adapter/dp/B07VT554J1?th=1">Raspberry Pi 4 Power Supply 5V 3A USB C Charger Adapter</a></li>
<li><a href="https://www.amazon.ca/gp/product/B07ZVJDRF3">Raspberry Pi 4 Case</a></li>
<li><a href="https://www.amazon.ca/gp/product/B072XBX3XX">GPIO Breakout kit</a></li>
<li><a href="https://www.amazon.ca/SanDisk-2-Pack-microSDHC-Memory-2x32GB/dp/B08J4HJ98L">32GB 2-Pack Ultra microSDHC</a></li>
</ol></li>
<li><p><a href="https://www.amazon.ca/Logitech-Widescreen-Calling-Recording-960-000694/dp/B004FHO5Y6/">Logitech C270 HD Webcam, HD 720p/30 fps</a></p></li>
<li><p>Desktop computer with Linux, Windows, or Mac operating system.</p></li>
<li><p>Wired or wireless local network.</p></li>
</ol>
<h2 id="methods">Methods</h2>
<p>The following procedures will guide you through the installation and configuration of all necessary software for developing code with this lab series in CST 8703.</p>
<h3 id="install-prerequisites-windows-10">Install Prerequisites (Windows 10)</h3>
<ol type="1">
<li><p>Install OpenSSH.</p>
<p>Follow instructions online to <a href="https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse#install-openssh-using-powershell">install OpenSSH</a>.</p>
<p>Follow instructions online to <a href="https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse#start-and-configure-openssh-server">start and configure OpenSSH</a>.</p></li>
<li><p>Follow instructions online to <a href="https://chocolatey.org/install">install Chocolatey</a>. Chocolatey has extensive documentation here: <a href="https://docs.chocolatey.org/">https://docs.chocolatey.org/</a>.</p></li>
<li><p>Install <a href="https://community.chocolatey.org/packages/git.install">Git with Chocolatey</a>. Open a powershell prompt as an administrator and run:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>choco install git.install</span></code></pre></div></li>
<li><p>Install <a href="https://community.chocolatey.org/packages/python3/3.10.4">Python with Chocolatey</a>. Open a powershell prompt as an administrator and run:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>choco install python3</span></code></pre></div></li>
<li><p>Follow instructions online to <a href="https://docs.microsoft.com/en-us/windows/wsl/install">install Windows Subsystem for Linux (WSL)</a>.</p>
<p>Reboot the system and open Ubuntu for the first time. The installation will continue and you will be prompted to enter a username and password. Upgrade Ubuntu with the commands:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="fu">sudo</span> apt update</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="fu">sudo</span> apt upgrade -y</span></code></pre></div>
<p>You can also install different distributions, such as Debian:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>Invoke-WebRequest -Uri https:<span class="dt">//aka.ms/wsl-debian-gnulinux</span> -OutFile ~<span class="dt">/debian.appx</span> -UseBasicParsing</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">Add</span>-AppxPackage -Path ~<span class="dt">/debian.appx</span></span></code></pre></div></li>
<li><p>Follow instructions online to <a href="https://docs.microsoft.com/en-us/windows/terminal/install">install Windows Terminal</a>. If you want to customize a pretty terminal prompt, <a href="https://ohmyposh.dev/">OhMyPosh</a> is recommended.</p></li>
<li><p>Follow instructions online to <a href="https://code.visualstudio.com/Docs/setup/setup-overview">install VS Code</a>.</p></li>
</ol>
<h3 id="install-prerequisites-ubuntu-20.04">Install Prerequisites (Ubuntu 20.04)</h3>
<blockquote>
<p><strong><em>NOTE:</em></strong> Ignore these instructions if you are using Windows or Mac. The following software (including VS Code) is only required if your home desktop computer is running Ubuntu.</p>
</blockquote>
<p>In a bash terminal, run the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="fu">sudo</span> apt install -y <span class="kw">\</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    <span class="fu">git</span> <span class="kw">\</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    <span class="ex">openssh-client</span> <span class="kw">\</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    <span class="ex">python3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="fu">sudo</span> snap install code --classic</span></code></pre></div>
<h3 id="install-raspberry-pi-os">Install Raspberry Pi OS</h3>
<ol type="1">
<li><p>Download and install the <a href="https://www.raspberrypi.com/software/">Raspberry Pi OS Imager application</a>.</p></li>
<li><p>Insert a blank MicroSD card into a reader attached to the host computer.</p></li>
<li><p>Run the program “Raspberry Pi Imager”</p></li>
<li><p>Follow these steps to configure the Raspberry Pi OS:</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Screenshot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1. Select ‘CHOOSE OS’</td>
<td><img src="raspi-imager-1.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager main window" /></td>
</tr>
<tr class="even">
<td>2. Select ‘Raspberry Pi OS (other)’</td>
<td><img src="raspi-imager-2.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager OS selection" /></td>
</tr>
<tr class="odd">
<td>3. Select ‘Raspberry Pi OS Lite (32-bit)’</td>
<td><img src="raspi-imager-3.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager other OS selection" /></td>
</tr>
<tr class="even">
<td>4. Click on the button with the gear symbol to set advanced options</td>
<td><img src="raspi-imager-3b.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager with visible settings button" /></td>
</tr>
<tr class="odd">
<td>5. Set custom hostname and enable SSH</td>
<td><img src="raspi-imager-4.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager advanced settings" /></td>
</tr>
<tr class="even">
<td>6. Set username and password and configure wireless LAN with your router SSID and password.</td>
<td><img src="raspi-imager-5.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager advanced settings" /></td>
</tr>
<tr class="odd">
<td>7. Set your locale and click ‘SAVE’</td>
<td><img src="raspi-imager-6.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager advanced settings" /></td>
</tr>
<tr class="even">
<td>8. Select ‘CHOOSE STORAGE’ and choose the MicroSD card.</td>
<td><img src="raspi-imager-7.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager advanced settings" /></td>
</tr>
<tr class="odd">
<td>9. Select ‘WRITE’ and wait for process to complete.</td>
<td><img src="raspi-imager-8.png" title="fig:" width="360" alt="Screenshot of Raspberry Pi Imager advanced settings" /></td>
</tr>
</tbody>
</table></li>
<li><p>Insert the microSD into your Raspberry Pi and connect it to a power source.</p></li>
</ol>
<h3 id="set-up-raspberry-pi-with-development-tools">Set Up Raspberry Pi With Development Tools</h3>
<p>When your Raspberry Pi is connected to power, it will turn on and connect to the local network with SSID and password provided in the previous section. You can also connect to the local network with an Ethernet cable instead of relying on WiFi. The first step in setting up for remote development is to connect to the Raspberry Pi with ssh by entering the following command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="fu">ssh</span> <span class="op">&lt;</span>username<span class="op">&gt;</span>@<span class="op">&lt;</span>hostname<span class="op">&gt;</span></span></code></pre></div>
<p>Enter <code>&lt;username&gt;</code> and <code>&lt;hostname&gt;</code> as configured when creating the OS image in the <a href="#install-raspberry-pi-os">previous section</a>. For example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="fu">ssh</span> chishok@raspi4</span></code></pre></div>
<p>If provided a warning “The authenticity of host ‘…’ can’t be established.”, simply respond “yes”.</p>
<p>If the hostname cannot be resolved, look at your router’s DHCP settings to find the assigned IP address corresponding to the Raspberry Pi and use that instead. You may also configure a reserved IP address just for your Pi by changing the appropriate settings in your router. For example if the IP address is <code>192.168.1.120</code>, login with the command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="fu">ssh</span> chishok@192.168.1.120</span></code></pre></div>
<p>Once connected to your Pi, the following steps will guide you through the initial setup for remote C/C++ and Python development:</p>
<ol type="1">
<li><p>Install C/C++ development tools with the following commands:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="fu">sudo</span> apt update</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="fu">sudo</span> apt upgrade -y</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="fu">sudo</span> apt install -y <span class="kw">\</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    <span class="fu">git</span> <span class="kw">\</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="ex">build-essential</span> <span class="kw">\</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    <span class="fu">cmake</span> <span class="kw">\</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    <span class="ex">clang-format</span> <span class="kw">\</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>    <span class="ex">shellcheck</span></span></code></pre></div></li>
<li><p>Install Python with the following command:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="fu">sudo</span> apt install -y <span class="kw">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    <span class="ex">python3</span> <span class="kw">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    <span class="ex">python3-pip</span> <span class="kw">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    <span class="ex">python3-venv</span> <span class="kw">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="ex">python3-setuptools</span> <span class="kw">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    <span class="ex">python3-flake8</span> <span class="kw">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    <span class="ex">python3-flake8-docstrings</span> <span class="kw">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    <span class="ex">python3-autopep8</span></span></code></pre></div></li>
<li><p>Configure Git with your name and email:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="fu">git</span> config --global user.name <span class="st">&quot;First Last&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="fu">git</span> config --global user.email <span class="st">&quot;student@algonquincollege.com&quot;</span></span></code></pre></div></li>
<li><p>Create ssh key pair with the command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="fu">ssh-keygen</span> -t rsa</span></code></pre></div>
<p>Do not enter a passphrase and accept all default options.</p></li>
<li><p>Source profile script from <code>~/.bash_profile</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;source </span><span class="va">${HOME}</span><span class="st">/.bashrc&quot;</span> <span class="op">&gt;&gt;</span> <span class="va">${HOME}</span>/.bash_profile</span></code></pre></div></li>
<li><p>Create local directory <code>~/.local</code> and add it to <code>PATH</code> environment variable with the following commands:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="fu">mkdir</span> -p <span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">/.local/bin&quot;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;export PATH=</span><span class="dt">\$</span><span class="st">{PATH}:</span><span class="va">${HOME}</span><span class="st">/.local/bin&quot;</span> <span class="op">&gt;&gt;</span> <span class="va">${HOME}</span>/.bash_profile</span></code></pre></div></li>
<li><p>For lab submissions, environment variables <code>AC_USERNAME</code> and <code>AC_EMAIL</code> must be set with your student id name and email. These variables can be set when logging in in by adding them to the bash profile script as follows:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;export AC_USERNAME=chishok&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">/.bash_profile&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;export AC_EMAIL=chishok@algonquincollege.com&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">/.bash_profile&quot;</span></span></code></pre></div>
<p>Replace <code>chishok</code> and <code>chishok@algonquincollege.com</code> with your own student name and email.</p></li>
</ol>
<h3 id="recommended-use-ssh-key-pair-to-connect-to-raspberry-pi">(Recommended) Use SSH key pair to Connect To Raspberry Pi</h3>
<p>Exit the ssh connection with the command <code>exit</code> to return to your desktop computer command line. Follow these steps from your home desktop computer to conveniently connect to the Raspberry Pi without having to enter a username and password:</p>
<ol type="1">
<li><p>Generate key pair</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>ssh-keygen -t rsa</span></code></pre></div>
<p>Do not enter a passphrase and accept all default options.</p></li>
<li><p>Copy your public key to the Raspberry Pi’s authorized keys file:</p>
<p>From Windows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>ssh-keygen -t rsa</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>cat $env:USERPROFILE\.ssh\id_rsa.pub | ssh chishok@raspi4 &quot;cat &gt;&gt; .ssh<span class="dt">/authorized_keys&quot;</span></span></code></pre></div>
<p>From Linux:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode ps"><code class="sourceCode postscript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>ssh-<span class="kw">copy</span>-id chishok@raspi4</span></code></pre></div></li>
</ol>
<p>You should now be able to <code>ssh</code> into your Raspberry Pi from your computer without having to enter a password.</p>
<h3 id="optional-local-network-static-ip-connection">(Optional) Local Network Static IP Connection</h3>
<p>If you do not have a router available with DHCP, you can also create a direct connection over ethernet with a cable connecting your personal computer to the Raspberry Pi. The following diagram shows the local network setup options:</p>
<figure>
<img src="Lab0-RaspberryPiHookUp.png" width="720" alt="" /><figcaption>Diagram of local network to connect to raspberry pi</figcaption>
</figure>
<blockquote>
<p><strong>NOTE</strong>: If you have access to a common local network provided by a router, there is no need to connect over a static IP address.</p>
</blockquote>
<p>A static IP and direct connection can be configured as follows:</p>
<ol type="1">
<li><p>Attach a keyboard an monitor to the Raspberry Pi and login.</p></li>
<li><p>Attach an ethernet cable to the Raspberry Pi 4 or to a USB-Ethernet adapter on the Zero 2 W. Attach the other end to your desktop or laptop computer.</p></li>
<li><p>From the terminal, check the device name of the ethernet port by running <code>ip addr</code>. On Debian (Raspberry Pi OS) ethernet devices start with <code>eth</code> followed by a number. You’ll likely only that the one physical ethernet device <code>eth0</code> listed.</p></li>
<li><p>Choose a static ip address for the Raspberry Pi. By convention, a local private network should choose ip addresses in the ranges:</p>
<ul>
<li><code>10.0.0.0</code> to <code>10.255.255.255</code></li>
<li><code>172.16.0.0</code> to <code>172.31.255.255</code></li>
<li><code>192.168.0.0</code> to <code>192.168.255.255</code></li>
</ul>
<p>For this example, we choose <code>172.16.1.110</code>.</p></li>
<li><p>Configure the static ip address. Use a <a href="https://linuxize.com/post/bash-heredoc/">heredoc</a> in bash to write the multi-line file in one command:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="fu">sudo</span> tee <span class="st">&quot;/etc/network/interfaces.d/static_network&quot;</span> <span class="op">&gt;</span> /dev/null <span class="op">&lt;&lt;EOF</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a># Static IP ethernet interface</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>allow-hotplug eth0</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>iface eth0 inet static</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>        address 172.16.1.110</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>        netmask 255.255.255.0</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>        gateway 172.16.1.110</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>        metric 30</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a>        post-up ip route del default dev eth0</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a><span class="op">EOF</span></span></code></pre></div>
<p>This creates a static IP address <code>172.16.1.110</code> on <code>eth0</code> with a netmask of <code>255.255.255.0</code> meaning it will only be able to connect to any other ip address starting with <code>172.16.1.</code>. The <code>allow-hotplug</code> bring up the interface when an ethernet cable is attached. The last line ensures it is not the default route when attempting to access the internet.</p></li>
<li><p>Choose an IP address for the desktop computer. For this example, we choose <code>172.16.1.120</code>.</p></li>
<li><p>Configure a static IP address on your desktop computer. On Windows, go to “Settings &gt; Ethernet” and click on the ethernet device connected to the Raspberry Pi. Edit the IP address, setting it to “Manual” with the following settings:</p>
<figure>
<img src="Lab0-windows-ip.png" width="360" alt="" /><figcaption>Windows Static IP Settings Screenshot</figcaption>
</figure>
<p>Use the same Gateway as selected in the Raspberry Pi configuration (<code>172.16.1.110</code> in this case), <code>24</code> subnet prefix which is equivalent to a mask of <code>255.255.255.0</code>, and the Windows IP static address (<code>172.16.1.120</code> in this example).</p></li>
<li><p>Reboot the Raspberry Pi and test the ssh connection from Windows:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="fu">ssh</span> chishok@172.16.1.110</span></code></pre></div></li>
</ol>
<h3 id="set-up-vs-code-for-ssh-remote-development-with-the-raspberry-pi">Set Up VS Code for SSH Remote Development With The Raspberry Pi</h3>
<ol type="1">
<li><p>Open VS Code and install the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack">Remote Development Extension Pack</a>.</p></li>
<li><p>Follow the instructions online to <a href="https://code.visualstudio.com/docs/remote/ssh#_connect-to-a-remote-host">connect to a remote host by SSH</a>.</p></li>
<li><p>You can now use VS Code as though it was running on the Raspberry Pi. Using the <a href="https://code.visualstudio.com/docs/editor/integrated-terminal">integrated terminal</a> is also very convenient.</p></li>
<li><p>While connected remotely, install the extensions in the table below. Refer to online help for more <a href="https://code.visualstudio.com/docs/remote/ssh#_managing-extensions">information about managing extensions</a> on remote hosts.</p>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="header">
<th>Extension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack">C/C++ Extension Pack</a></td>
<td>C/C++ build and debug, CMake integration, code-completion suggestions, etc.</td>
</tr>
<tr class="even">
<td><a href="https://marketplace.visualstudio.com/items?itemName=xaver.clang-format">Clang-Format</a></td>
<td>C/C++ code formatting.</td>
</tr>
<tr class="odd">
<td><a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python</a></td>
<td>Python integration, debugging, linting, formatting, etc.</td>
</tr>
</tbody>
</table></li>
</ol>
<p>Optional extensions for themes and syntax highlighting (install on desktop computer):</p>
<table>
<thead>
<tr class="header">
<th>Extension</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://marketplace.visualstudio.com/items?itemName=jeff-hykin.better-cpp-syntax">Better C++ Syntax</a></td>
<td>Improves syntax highlighting.</td>
</tr>
<tr class="even">
<td><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-themes">C/C++ Themes</a></td>
<td>Color syntax themes for C/C++ code.</td>
</tr>
<tr class="odd">
<td><a href="https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme">Material Icon Theme</a></td>
<td>Improved file icons.</td>
</tr>
<tr class="even">
<td><a href="https://marketplace.visualstudio.com/items?itemName=timonwong.shellcheck">Shellcheck</a></td>
<td>Bash script linting.</td>
</tr>
</tbody>
</table>
<h3 id="retrieve-lab-source">Retrieve Lab Source</h3>
<p>On the Raspberry Pi (or local Linux system, if desired), checkout the code sample for this lab:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="fu">git</span> clone https://github.com/chishok/CST8703-Lab0</span></code></pre></div>
<p>Run VS Code on your desktop computer and connect remotely with SSH (or WSL if on Windows without a Raspberry Pi). Open the folder <code>CST8703-Lab0</code> checked out with Git. The following screenshot shows how the folder should eventually appear:</p>
<figure>
<img src="vscode-1.png" alt="" /><figcaption>Screenshot of VS Code</figcaption>
</figure>
<h3 id="build-and-debug">Build and Debug</h3>
<blockquote>
<p><strong><em>NOTE</em></strong>: For more information on how to use CMake Tools on VS Code, refer to the <a href="https://code.visualstudio.com/docs/cpp/cmake-linux">help available online</a>.</p>
</blockquote>
<ol type="1">
<li><p>Click on kits button at the bottom of VS Code window taskbar. <a href="https://code.visualstudio.com/docs/cpp/cmake-linux#_select-a-kit">Select the GCC compiler kit</a>.</p>
<figure>
<img src="vscode-2.png" alt="" /><figcaption>Screenshot of VS Code with CMake kits selection</figcaption>
</figure></li>
<li><p>Select the CMake button and choose the Build type “Debug.”</p>
<p>CMake will configure and a <code>build</code> folder is created where target programs are created. The following screenshot shows the output on successful build:</p>
<figure>
<img src="vscode-3.png" alt="" /><figcaption>Screenshot of VS Code with CMake configuration output</figcaption>
</figure></li>
<li><p>Select a target program by clicking on <code>[all]</code> button on bottom taskbar and choosing <code>CST8703Lab0-HelloWorld</code> as shown here:</p>
<figure>
<img src="vscode-4.png" alt="" /><figcaption>Screenshot of VS Code to select target</figcaption>
</figure></li>
<li><p>Click the “Build” button on the bottom taskbar to build the target. The build process output is shown here:</p>
<figure>
<img src="vscode-5.png" alt="" /><figcaption>Screenshot of VS Code with build output</figcaption>
</figure></li>
<li><p>Click the “Play” button beside the target name to run the program. The terminal appears with output from running the program as shown here:</p>
<figure>
<img src="vscode-6.png" alt="" /><figcaption>Screenshot of VS Code with run output</figcaption>
</figure></li>
<li><p>Open <code>HelloWorld/main.c</code> and create a breakpoint on line 112.Debug the program by clicking on the “Bug” button on the bottom taskbar. VS Code enters debug mode as shown here:</p>
<figure>
<img src="vscode-debug.png" alt="" /><figcaption>Screenshot of VS Code while debugging</figcaption>
</figure>
<p>More information on <a href="https://code.visualstudio.com/docs/cpp/cpp-debug">debugging in VS Code can be found online</a>.</p></li>
</ol>
<h3 id="coding-task-provide-thread-and-timing-information">Coding Task: Provide thread and timing information</h3>
<p>Alter the target program to set scheduling parameters of the main thread, retrieve time, and cause the main program to sleep for 30 seconds. Make your modifications between the comments</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>    <span class="co">/*</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="co">     * STUDENT WORK SECTION </span><span class="re">BEGIN</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="co">     * ==========================</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a><span class="co">     */</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>    <span class="co">/*</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="co">     * ========================</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="co">     * STUDENT WORK SECTION </span><span class="re">END</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="co">     */</span></span></code></pre></div>
<p>Hints and instruction may be provided as comments in the code. Write code to do the following:</p>
<ol type="1">
<li>Set the following for the main thread:
<ol type="1">
<li>Scheduling priority: 90</li>
<li>Scheduling policy: <code>SCHED_RR</code></li>
</ol></li>
<li>Retrieve the following information from the main thread:
<ol type="1">
<li>Scheduling priority</li>
<li>Scheduling policy</li>
<li>Thread name</li>
<li>Thread ID</li>
<li>Minimum priority for current scheduling policy</li>
<li>Maximum priority for current scheduling policy</li>
</ol></li>
<li>Get the current time from the following real-time clocks:
<ol type="1">
<li><code>CLOCK_REALTIME</code></li>
<li><code>CLOCK_MONOTONIC</code></li>
</ol></li>
<li>Get the resolution of the following real-time clocks:
<ol type="1">
<li><code>CLOCK_REALTIME</code></li>
<li><code>CLOCK_MONOTONIC</code></li>
</ol></li>
<li>Sleep until 30 seconds after current time was retrieved on <code>CLOCK_MONOTONIC</code>. Use the absolute time flag (see <code>man clock_nanosleep</code> for more information).</li>
</ol>
<h3 id="run-the-program-from-terminal">Run the Program From Terminal</h3>
<ol type="1">
<li><p>Build and run the code using the CMake-Tools in VS Code by using the taskbar buttons at the bottom of the window or commands with <code>Ctrl+Shift+P</code> (refer to instructions above for details).</p></li>
<li><p>Locate the built program <code>CST8703Lab0-HelloWorld</code> in the folder <code>./build/HelloWorld/CST8703Lab0-HelloWorld</code> and run it in the terminal:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="ex">./build/HelloWorld/CST8703Lab0-HelloWorld</span></span></code></pre></div>
<p>The output should show information about the process. If you see the priority and policy as</p>
<pre class="text"><code>    policy: SCHED_OTHER
    thread priority: 0</code></pre>
<p>then it likely did not have permission to change the scheduling and priority.</p></li>
<li><p>Re-run with <code>sudo</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="fu">sudo</span> ./build/HelloWorld/CST8703Lab0-HelloWorld</span></code></pre></div>
<p>and it should output the desired policy and priority:</p>
<pre class="text"><code>    policy: SCHED_RR
    thread priority: 90</code></pre></li>
<li><p>Open a second terminal. It’s recommended to use VS Code’s <a href="https://code.visualstudio.com/docs/editor/integrated-terminal">integrated terminal</a> and split it so you have two <a href="https://code.visualstudio.com/docs/editor/integrated-terminal#_grouping">side-by-side</a>.</p></li>
<li><p>Run the program on the left terminal without using <code>sudo</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="ex">./build/HelloWorld/CST8703Lab0-HelloWorld</span></span></code></pre></div></li>
<li><p>While running the program during the 30 second pause in execution, access and terminate process using the following Linux tools and commands in the second terminal to the right:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="va">HELLO_PID=$(</span><span class="ex">pgrep</span> -f HelloWorld<span class="va">)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="fu">ps</span> -F -p <span class="va">${HELLO_PID}</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="bu">kill</span> -s TERM <span class="va">${HELLO_PID}</span></span></code></pre></div></li>
</ol>
<h2 id="analysis">Analysis</h2>
<ol type="1">
<li>What does the command <code>pgrep -f HelloWorld</code> do?</li>
<li>Does the process idea printed out when you run the program consistent with the result of <code>pgrep -f HelloWorld</code> while it’s running?</li>
<li>What does the command <code>ps -F -p ${HELLO_PID}</code> do?</li>
<li>What does the command <code>kill -s TERM ${HELLO_PID}</code> do? What is the meaning of the word <code>TERM</code> in this command?</li>
<li>Why are <code>root</code> user privileges required (using “super-user do” command <code>sudo</code>) for the program to be able to modify real-time scheduling and priority?</li>
</ol>
<h2 id="submission">Submission</h2>
<p>Provide a short report with Your</p>
<p>If you forked the repo on your personal GitHub, commit and push your changes, then download your repo as a zip file. If you do not use GitHub, compress the source code in a zip file or tar file. Have a look at <code>man tar</code> or <code>man zip</code> for more information. Once the code is submitted, it will be run using the command:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="ex">./scripts/run_submission.sh</span></span></code></pre></div>
<p>The expected contents of output_user.txt should be similar to:</p>
<pre class="text"><code>pthread_setschedparam: Operation not permitted
Hello World!
    timestamp: 2022-05-17 23:50:55
    CLOCK_REALTIME (epoch)
                  seconds: 1652845596
              nanoseconds: 125681800
        resolution (nsec): 1
    CLOCK_MONOTONIC
                  seconds: 24198
              nanoseconds: 538200
        resolution (nsec): 1
    process id: 16222
    user id: 1000
    Main thread info:
        policy: SCHED_OTHER
        min priority: 0
        max priority: 0
        thread priority: 0
        thread id: 140187543078720

Waiting for 30 seconds...
UID        PID  PPID  C    SZ   RSS PSR STIME TTY          TIME CMD
chishok  16607 16462  0   613   604   4 23:50 pts/8    00:00:00 ./build/HelloWorld/CST8703Lab0-HelloWorld</code></pre>
<p>The expected contents of output_root.txt:</p>
<pre class="text"><code>Hello World!
    timestamp: 2022-05-17 23:50:59
    CLOCK_REALTIME (epoch)
                  seconds: 1652845601
              nanoseconds: 880888700
        resolution (nsec): 1
    CLOCK_MONOTONIC
                  seconds: 24203
              nanoseconds: 755745100
        resolution (nsec): 1
    process id: 16251
    user id: 0
    Main thread info:
        policy: SCHED_RR
        min priority: 1
        max priority: 99
        thread priority: 90
        thread id: 140532105078592

Waiting for 30 seconds...
Done.</code></pre>
<h2 class="unnumbered" id="references">References</h2>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-Kerrisk2010">
<p>[1] M. Kerrisk, <em>The linux programming interface : A linux and unix system programming handbook</em>. No Starch Press, 2010.</p>
</div>
</div>
</body>
</html>
